
const flowData = 
  {"STMC2":[[1981,145.218227],[1982,376.84416899999997],[1983,411.4941759999999],[1984,505.894602],[1985,326.711816],[1986,320.278885],[1987,168.43775999999997],[1988,229.43527300000002],[1989,152.469443],[1990,165.76977],[1991,239.60503],[1992,153.73128],[1993,296.40395900000004],[1994,144.660078],[1995,285.67320000000007],[1996,382.278184],[1997,423.556295],[1998,282.03703],[1999,247.94229],[2000,253.197897],[2001,191.23835000000003],[2002,82.11843200000001],[2003,251.27927100000002],[2004,149.78193600000003],[2005,239.174789],[2006,297.730568],[2007,165.846378],[2008,338.53778000000005],[2009,286.55828500000007],[2010,228.271273],[2011,535.2965769999998],[2012,105.224021],[2013,194.355509],[2014,366.10069000000004],[2015,273.734563],[2016,313.824216],[2017,197.484297],[2018,197.004165],[2019,350.836873],[2020,254.67436499999997],[2021,97.35843]],"MBLC2":[[1981,460.381693],[1982,1180.040429],[1983,1316.577321],[1984,1920.398298],[1985,1353.9509279999997],[1986,1315.7408249999999],[1987,560.008457],[1988,800.5556230000001],[1989,511.80280300000004],[1990,547.9427850000001],[1991,737.001784],[1992,465.5109480000001],[1993,1131.3754079999999],[1994,493.20336000000003],[1995,1323.525861],[1996,1321.0783359999998],[1997,1532.6075960000003],[1998,1193.4990139999995],[1999,886.984588],[2000,777.022408],[2001,585.8854110000001],[2002,269.44408300000003],[2003,891.5533039999999],[2004,547.9199010000001],[2005,1030.321467],[2006,976.4997869999999],[2007,560.919884],[2008,1359.431772],[2009,1138.159146],[2010,897.5555389999998],[2011,2024.1526309999997],[2012,336.77629399999995],[2013,567.8468769999998],[2014,1092.4057500000001],[2015,778.3412320000001],[2016,1061.505134],[2017,796.565625],[2018,573.786704],[2019,1255.7434900000003],[2020,813.219517],[2021,281.28204]],"YDLC2":[[1982,-39996],[1983,2029.040536],[1984,2695.4181729999996],[1985,1855.224174],[1986,1862.9578159999999],[1987,762.9532520000001],[1988,1144.049781],[1989,627.2748999999999],[1990,708.043703],[1991,899.9081839999999],[1992,596.2366739999999],[1993,1472.1320759999996],[1994,657.1243279999999],[1996,-39996],[1997,1909.065074],[1998,1662.524385],[1999,1333.960053],[2000,1036.777478],[2001,788.2481670000001],[2002,366.16286399999996],[2003,1094.001022],[2004,698.5763029999998],[2005,1352.321691],[2006,1203.733981],[2007,753.2873979999999],[2008,1724.175647],[2009,1617.846724],[2010,1375.849684],[2011,2880.524134],[2012,419.411521],[2013,715.3241989999999],[2014,1415.236915],[2015,1042.5595270000001],[2016,1490.6792469999998],[2017,1046.4696949999998],[2018,708.849547],[2019,1681.1162239999999],[2020,1119.724064],[2021,356.928903]],"STIU1":[[1981,19.941535],[1982,109.45081200000003],[1983,154.752073],[1984,154.69326799999996],[1985,87.615627],[1986,137.720292],[1987,16.912844999999997],[1988,16.584697],[1989,19.966241],[1990,16.849273],[1991,31.055887],[1992,1.5627569999999993],[1993,76.75118800000001],[1994,11.475354],[1995,116.855389],[1996,72.53349499999999],[1997,114.19285500000002],[1998,100.110022],[1999,30.517779999999995],[2000,16.211757999999996],[2001,14.511497],[2002,9.259843],[2003,12.072402000000002],[2004,15.391577999999997],[2005,81.608538],[2006,59.05737400000001],[2007,2.958628],[2008,50.057265],[2009,57.898689000000005],[2010,27.937219000000002]],"CRUU1":[[1981,0],[1982,0],[1983,35.534],[1984,35.534],[1985,35.534],[1986,35.534],[1987,35.534],[1988,0],[1989,13.515588],[1990,10.259317000000001],[1991,12.356459000000001],[1992,5.072222999999999],[1993,28.125893],[1994,12.135404],[1995,42.792307],[1996,30.547852000000002],[1997,33.526345],[1998,25.498305000000002],[1999,19.960238999999994],[2000,10.27950252379],[2001,12.898356999999999],[2002,5.412698000000001],[2003,9.054167999999999],[2004,11.478373],[2005,35.077977],[2006,20.858134000000003],[2007,7.7196419999999994],[2008,20.11647],[2009,17.446429000000002],[2010,12.046227],[2011,50.03925399999999]],"STAU1":[[1981,42.971762],[1982,198.68523900000002],[1983,209.69523800000002],[1984,167.886905],[1985,172.13928700000002],[1986,295.638254],[1987,63.382857],[1988,30.67236345460001],[1989,45.058801],[1990,40.14478100000001],[1991,61.026022],[1992,17.574256000000002],[1993,148.860103],[1994,38.149364],[1995,219.502498],[1996,178.048858],[1997,221.359306],[1998,202.72859700000004],[1999,104.78410600000001],[2000,47.830031227300005],[2001,61.931856],[2002,29.863881000000003],[2003,45.247080999999994],[2004,46.815174999999996],[2005,188.11398400000002],[2006,122.95939600000003],[2007,30.882411],[2008,108.48839799999999],[2009,108.59662900000001],[2010,60.375321]],"TADU1":[[1981,70.121032],[1982,141.630953],[1983,160.50396800000001],[1984,141.021826],[1985,118.20833400000001],[1986,167.097223],[1987,68.095239],[1988,52.63724],[1989,59.57072300000001],[1990,61.115683999999995],[1991,74.273502],[1992,33.378173000000004],[1993,117.380058],[1994,43.556065000000004],[1995,154.11245600000004],[1996,109.35393299999998],[1997,150.379407],[1998,139.75070200000002],[1999,124.99710300000001],[2000,65.41990676192],[2001,70.553032],[2002,38.175596999999996],[2003,54.72460300000001],[2004,54.446228000000005],[2005,142.89325399999998],[2006,119.05555700000001],[2007,51.247619],[2008,90.70595],[2009,107.64186299999999],[2010,72.523218]],"DADU1":[[1981,115.64484200000001],[1982,246.168651],[1983,274.591271],[1984,261.33531800000003],[1985,203.454365],[1986,316.12896900000004],[1987,148.095238],[1988,128.3411839545],[1989,115.08394600000001],[1990,132.255889],[1991,139.02199300000004],[1992,78.122269],[1993,224.514057],[1994,90.29885800000001],[1995,283.07212300000003],[1996,211.07556799999998],[1997,271.975931],[1998,252.764052],[1999,223.188927],[2000,122.64139876191001],[2001,133.698334],[2002,70.56774],[2003,112.99303100000002],[2004,109.908991],[2005,273.066157],[2006,210.01938299999998],[2007,96.94706500000001],[2008,164.86977499999998],[2009,196.912721],[2010,136.48653499999998],[2011,416.553595]],"DURU1":[[1981,112.883825],[1982,433.561922],[1983,832.3709999999999],[1984,452.381809],[1985,317.09982699999995],[1986,768.4637779999999],[1987,287.69209500000005],[1988,90.21138],[1989,78.14509699999999],[1990,120.30376299999998],[1991,150.179079],[1992,43.297539],[1993,346.231763],[1994,65.541794],[1995,705.336096],[1996,326.46785500000004],[1997,578.0960469999999],[1998,568.7232369999999],[1999,429.18841299999997],[2000,97.56232900000002],[2001,194.31209900000005],[2002,29.218080999999998],[2003,106.23871500000001],[2004,83.513309],[2005,694.806205],[2006,307.438033],[2007,73.709095],[2008,227.373586],[2009,282.19319],[2010,184.002031],[2011,968.872069]],"GRVU1":[[1981,1384.765306],[1982,3740.9904050000005],[1983,5743.5224130000015],[1984,5629.523207000001],[1985,3665.2738260000006],[1986,5403.34943],[1987,2206.6065869999998],[1988,1904.070476],[1989,1370.4030309999998],[1990,1459.550553],[1991,2089.127879],[1992,1044.591146],[1993,3321.527156],[1994,1112.853252],[1995,4339.507633],[1996,3452.779002],[1997,4717.572824],[1998,4268.081665],[1999,3762.484969],[2000,1755.1645480000002],[2001,1659.864918],[2002,694.7234779999999],[2003,1858.010302],[2004,1389.7603569999999],[2005,3834.7519620000007],[2006,2524.9839070000003],[2007,1355.0021410000002],[2008,3072.9920149999994],[2009,3371.272651],[2010,2474.5888720000003]],"MNRC2":[[1981,16.1925850161],[1982,35.264483243849995],[1983,61.3582518116],[1984,43.057957705259994],[1985,-39996],[1986,-39996],[1987,-39996],[1988,-39996],[1989,-39996],[1990,-39996],[1991,23.76025183645],[1992,40.085054259530004],[1993,51.89834321744],[1994,25.890501],[1995,49.1763813333],[1996,12.534752552179997],[1997,45.50645868991],[1998,37.09850405867],[1999,28.877757],[2000,22.483238475359997],[2001,27.147829700520003],[2002,5.621110079828002],[2003,19.4374053913],[2004,22.599069],[2005,51.945784650700006],[2006,16.18880161352],[2007,20.06661717857],[2008,31.529301],[2009,24.440477340780003],[2010,24.89014761323],[2011,30.411792000000005],[2012,13.383069999999998],[2013,9.926941000000001],[2014,16.437208000000002],[2015,25.712085999999996]],"BFFU1":[[1981,549.225515],[1982,1213.1387040000002],[1983,1858.8984890000004],[1984,1405.5478280000002],[1985,2093.264476],[1986,1915.77655],[1987,1898.4884879999995],[1988,758.6983049999999],[1989,632.304293],[1990,742.9746879999999],[1991,918.9327820000002],[1992,1178.2362429999998],[1993,1765.4548079999995],[1994,895.6364039999999],[1995,1689.1935699999997],[1996,391.6977529999999],[1997,1613.6443199999999],[1998,922.71488],[1999,1229.716433],[2000,513.931552],[2001,1121.378664],[2002,-59.82317099999986],[2003,391.138917],[2004,809.5379629999999],[2005,1821.3495039999998],[2006,557.307093],[2007,819.5254129999997],[2008,1381.1894459999999],[2009,978.88256],[2010,899.8800069999999],[2011,898.8395669999999],[2012,384.8577260000002],[2013,303.34715800000004],[2014,648.0906540000001],[2015,1051.8867819999998],[2016,818.1152169999998],[2017,1160.3437889999998],[2018,133.57887100000005],[2019,1828.228671],[2020,473.01807299999996]],"LCTU1":[[1981,34.64675799999999],[1982,55.00310999999999],[1983,63.034795],[1984,60.848040000000005],[1985,41.370979000000005],[1986,55.824644],[1987,27.514774999999997],[1988,21.231478999999997],[1989,28.32256299999999],[1990,29.458972999999997],[1991,34.390274999999995],[1992,20.197575999999998],[1993,53.835323],[1994,28.272599999999997],[1995,51.605605000000004],[1996,39.124799],[1997,45.799294],[1998,51.99492000000001],[1999,34.958242],[2000,25.292039000000003],[2001,24.972561000000002],[2002,29.362298999999997],[2003,25.591524],[2004,29.321358999999998],[2005,46.77502199999999],[2006,48.122672],[2007,22.883353],[2008,31.649636999999995],[2009,43.153424],[2010,31.229259],[2011,54.64816900000001],[2012,23.957144999999993],[2013,24.217178],[2014,26.598729000000002],[2015,20.949291],[2016,27.505750000000003],[2017,42.522067],[2018,22.095855999999998],[2019,42.432373000000005],[2020,30.259819]],"BCTU1":[[1981,26.352185],[1982,48.039525],[1983,61.42326599999999],[1984,58.67503000000001],[1985,46.439716000000004],[1986,58.72905900000001],[1987,25.088594],[1988,19.334508],[1989,24.263213],[1990,20.896848000000002],[1991,28.650431000000005],[1992,16.437948000000002],[1993,48.203379],[1994,28.633829],[1995,56.300519],[1996,43.333265999999995],[1997,51.458154],[1998,53.503508],[1999,40.837464],[2000,23.996873],[2001,23.359208000000002],[2002,29.656248],[2003,26.038994000000002],[2004,26.128051999999997],[2005,45.527379999999994],[2006,39.087847],[2007,20.019599],[2008,32.84388299999999],[2009,44.126614000000004],[2010,29.266238],[2011,66.60732200000001],[2012,24.505634000000004],[2013,24.514955],[2014,23.056449999999998],[2015,16.705063000000003],[2016,23.278003],[2017,33.923288],[2018,19.043295],[2019,40.85551400000001],[2020,25.59668]],"CCSU1":[[1981,5.325061],[1982,11.236733999999998],[1983,21.579995000000004],[1984,17.965557],[1985,9.384549999999999],[1986,14.765348],[1987,4.226259],[1988,2.841678999999999],[1989,4.757551],[1990,2.494214],[1991,5.683831999999999],[1992,2.428382],[1993,10.094732],[1994,4.441326],[1995,11.502817],[1996,8.300426],[1997,8.382739],[1998,12.045574],[1999,8.804901],[2000,5.978396999999999],[2001,4.523204],[2002,4.881873999999999],[2003,2.8368179999999996],[2004,4.813902],[2005,9.340815000000001],[2006,10.844207],[2007,4.382973],[2008,5.827414999999999],[2009,9.101747],[2010,6.024572],[2011,16.19291],[2012,3.4906500000000005],[2013,3.3108880000000003],[2014,3.5936909999999997],[2015,4.000659],[2016,4.141486],[2017,7.693881],[2018,2.102479],[2019,8.078672999999998],[2020,3.548428]],"EGLC2":[[1981,705.4420869999999],[1982,1451.325413],[1983,2102.661115],[1984,2496.248071],[1985,1786.0321489999997],[1986,1904.3678380000001],[1987,987.551028],[1988,1214.257391],[1989,953.568117],[1990,949.19137],[1991,1197.585127],[1992,958.8382239999999],[1993,1805.598477],[1994,925.911866],[1995,1969.430582],[1996,1924.2178329999995],[1997,2130.09881],[1998,1143.9855669999997],[1999,1324.8387210000003],[2000,1217.7883849999998],[2001,975.2057950000001],[2002,407.49514600000003],[2003,1415.4201130000004],[2004,715.87699],[2005,1313.272816],[2006,1366.8059799999999],[2007,1128.498704],[2008,1881.3069690000002],[2009,1784.1647849999995],[2010,1329.12185]],"CAMC2":[[1981,1177.8425980000002],[1982,2417.7719349999998],[1983,3712.6806340000003],[1984,4488.334876],[1985,3450.2198089999997],[1986,3370.477898],[1987,1779.25636],[1988,1807.015305],[1989,1517.373411],[1990,1476.662984],[1991,1997.9148559999999],[1992,1566.487112],[1993,3200.8648030000004],[1994,1610.1878600000005],[1995,3427.3419759999997],[1996,2856.1810170000003],[1997,3485.165727],[1998,2253.890026],[1999,2135.349285],[2000,1873.8553119999997],[2001,1614.399865],[2002,714.7769340000001],[2003,2159.2845569999995],[2004,1268.3027679999998],[2005,2373.532507],[2006,2279.8887909999994],[2007,1835.8494830000002],[2008,3176.0966479999997],[2009,2922.930045],[2010,2192.191848]],"CLRU1":[[1981,1961.6977829999996],[1982,4693.538404],[1983,7854.790147999999],[1984,9180.475890605001],[1985,7212.8886506],[1986,6573.021516000001],[1987,4670.233082000001],[1988,3037.593139],[1989,2647.760745],[1990,2333.556672],[1991,3554.925504],[1992,3197.690289],[1993,6627.734549],[1994,2968.2358930000005],[1995,7108.097026000001],[1996,4724.667538],[1997,6663.18216],[1998,4563.968852],[1999,4033.103378],[2000,3205.358977],[2001,2928.3995239999995],[2002,1056.786879],[2003,3284.397974],[2004,2511.012332],[2005,4919.392878],[2006,3646.325414],[2007,3180.4128449999994],[2008,5983.065987],[2009,5092.905130000001],[2010,3798.2772710000004],[2011,6760.8680140000015],[2012,1524.3967099999998],[2013,2511.432401],[2014,4755.187179999999],[2015,4165.335093000001]]}

const flowDataGB = {"BCTU1":[[1981,26.352185],[1982,48.039525],[1983,61.42326599999999],[1984,58.67503000000001],[1985,46.439716000000004],[1986,58.72905900000001],[1987,25.088594],[1988,19.334508],[1989,24.263213],[1990,20.896848000000002],[1991,28.650431000000005],[1992,16.437948000000002],[1993,48.203379],[1994,28.633829],[1995,56.300519],[1996,43.333265999999995],[1997,51.458154],[1998,53.503508],[1999,40.837464],[2000,23.996873],[2001,23.359208000000002],[2002,29.656248],[2003,26.038994000000002],[2004,26.128051999999997],[2005,45.527379999999994],[2006,39.087847],[2007,20.019599],[2008,32.84388299999999],[2009,44.126614000000004],[2010,29.266238],[2011,66.60732200000001],[2012,24.505634000000004],[2013,24.514955],[2014,23.056449999999998],[2015,16.705063000000003],[2016,23.278003],[2017,33.923288],[2018,19.043295],[2019,40.85551400000001],[2020,25.59668]],"CCSU1":[[1981,5.325061],[1982,11.236733999999998],[1983,21.579995000000004],[1984,17.965557],[1985,9.384549999999999],[1986,14.765348],[1987,4.226259],[1988,2.841678999999999],[1989,4.757551],[1990,2.494214],[1991,5.683831999999999],[1992,2.428382],[1993,10.094732],[1994,4.441326],[1995,11.502817],[1996,8.300426],[1997,8.382739],[1998,12.045574],[1999,8.804901],[2000,5.978396999999999],[2001,4.523204],[2002,4.881873999999999],[2003,2.8368179999999996],[2004,4.813902],[2005,9.340815000000001],[2006,10.844207],[2007,4.382973],[2008,5.827414999999999],[2009,9.101747],[2010,6.024572],[2011,16.19291],[2012,3.4906500000000005],[2013,3.3108880000000003],[2014,3.5936909999999997],[2015,4.000659],[2016,4.141486],[2017,7.693881],[2018,2.102479],[2019,8.078672999999998],[2020,3.548428]],"LCTU1":[[1981,34.64675799999999],[1982,55.00310999999999],[1983,63.034795],[1984,60.848040000000005],[1985,41.370979000000005],[1986,55.824644],[1987,27.514774999999997],[1988,21.231478999999997],[1989,28.32256299999999],[1990,29.458972999999997],[1991,34.390274999999995],[1992,20.197575999999998],[1993,53.835323],[1994,28.272599999999997],[1995,51.605605000000004],[1996,39.124799],[1997,45.799294],[1998,51.99492000000001],[1999,34.958242],[2000,25.292039000000003],[2001,24.972561000000002],[2002,29.362298999999997],[2003,25.591524],[2004,29.321358999999998],[2005,46.77502199999999],[2006,48.122672],[2007,22.883353],[2008,31.649636999999995],[2009,43.153424],[2010,31.229259],[2011,54.64816900000001],[2012,23.957144999999993],[2013,24.217178],[2014,26.598729000000002],[2015,20.949291],[2016,27.505750000000003],[2017,42.522067],[2018,22.095855999999998],[2019,42.432373000000005],[2020,30.259819]]}
function median(numbers) {
  const sorted = numbers.slice().sort((a, b) => a - b);
  const middle = Math.floor(sorted.length / 2);
  // console.log('middle', middle)
  if (sorted.length % 2 === 0) {
      return (sorted[middle - 1] + sorted[middle]) / 2;
  }

  return sorted[middle];
}
const stnPercentFlow = {}
const firstSet = []
const secondSet = []
const normalsByStn = {}
const negBarDataByStn = {}
const rangeChartData = {}
// console.log('flowData', flowData)
for(var stn in flowData){
  // console.log('stn', stn)
  const returnAr = []
  const stnData = flowData[stn]
  const firstSet = []
  const secondSet = []
  const stnRangeData = []
  stnData.map(curr=>{
    const year = curr[0]
    const val = curr[1]
    // console.log('val', val, year)
    if(year >=1981 && year <=2010){
      firstSet.push(val)
    }
    if(year >=1991 && year <=2020){
      secondSet.push(val)
    }
  })
  // console.log('firstSet', firstSet)
  // console.log('secondSet', secondSet)
  const firstMedian = median(firstSet)
  const secondMedian = median(secondSet)
// console.log('stn', stn)
const firstMedianPercentArray = []
const secondMedianPercentArray = []
const categories = []
const firstValsDiff = []
const secondValsDiff = []
  stnData.map(curr=>{
    const year = curr[0]
    const val = curr[1]
    const obPercent1 = val/firstMedian
    const obPercent2 = val/secondMedian
    categories.push(year)
    firstValsDiff.push(val-firstMedian)
    secondValsDiff.push(val - secondMedian)
    stnRangeData.push([year, obPercent1, obPercent2])
    // if(year > 2010){
        // console.log('val', val, year)
        firstMedianPercentArray.push([year, obPercent1])
        secondMedianPercentArray.push([year, obPercent2])
        // console.log('ob2', obPercent1)
    // }
    
  }
  )
  rangeChartData[stn]=stnRangeData
  if(firstMedianPercentArray.length > 0 && secondMedianPercentArray.length >0){

    stnPercentFlow[stn]={firstMedianPercentArray, secondMedianPercentArray}
    negBarDataByStn[stn]={categories, firstValsDiff, secondValsDiff}
  }
  
}
// console.log(JSON.stringify(rangeChartData['BCTU1']))
console.log(JSON.stringify(stnPercentFlow))
// console.log(JSON.stringify(negBarDataByStn['BCTU1']))


// [
//   { name: 'AFPU1', low: 18.8499065, high: 20.118446 },
//   { name: 'BCTU1', low: 28.958334500000003, high: 31.250065499999998 },
//   { name: 'BERU1', low: 100.74044200000002, high: 106.25250449999999 },
//   { name: 'BORW4 backwards', low: 79.80689900000002, high: 85.90964 },
//   { name: 'BRBW4', low: 142.55893050000003, high: 145.30207000000001 },
//   { name: 'CCSU1', low: 5.755623499999999, high: 6.0014845 },
//   { name: 'CIVU1', low: 25.346764, high: 36.5256 },
//   { name: 'ECAU1', low: 9.291663499999999, high: 13.484917499999998 },
//   { name: 'EMIU1', low: 2.485606, high: 2.485606 },
//   {
//     name: 'EVAW4 backwards',
//     low: 105.82209100000001,
//     high: 109.1622545
//   },
//   { name: 'HRMU1', low: 26.076679999999996, high: 27.363951999999998 },
//   { name: 'LCTU1', low: 30.744539, high: 34.51851649999999 },
//   { name: 'LGNU1', low: 84.6386315, high: 91.351091 },
//   {
//     name: 'MCLU1 backwards',
//     low: 2.8625429999999996,
//     high: 3.1334859999999995
//   },
//   { name: 'MILU1', low: 4.4237225, high: 5.043756 },
//   { name: 'OAWU1', low: 98.60682, high: 113.9580135 },
//   { name: 'PRZU1', low: 26.082432499999996, high: 33.773535499999994 },
//   { name: 'WOOU1', low: 105.3940585, high: 110.796633 }
// ]


// ar data = [{
//   name: 'Austria',
//   low: 69,
//   high: 82
// }, {
//   name: 'Belgium',
//   low: 70,
//   high: 81
// }, {
//   name: 'Bulgaria',
//   low: 69,
//   high: 75
// }, {
//   name: 'Croatia',
//   low: 65,
//   high: 78
// }, {
//   name: 'Cyprus',
//   low: 70,
//   high: 81