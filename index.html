<!-- <script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script> -->

<html>
   <head>
      <title>BCTU1 Scatterplot</title>
      <script src="https://code.highcharts.com/highcharts.js"></script>
      <script src="https://code.highcharts.com/highcharts-more.js"></script>
      <script src="https://code.highcharts.com/modules/dumbbell.js"></script>
      <script src="https://code.highcharts.com/modules/exporting.js"></script>
      <script src="https://code.highcharts.com/modules/export-data.js"></script>
      <script src="https://code.highcharts.com/modules/accessibility.js"></script>
   </head>
   
   <body>
      <div id = "container" style = "width: 550px; height: 400px; margin: 0 auto"></div>
      <div id = "container1" style = "width: 550px; height: 400px; margin: 0 auto"></div>
      
      <script type = "text/javascript">
        const flowDataPercent =
        [
          {
            name: 'BCTU1',
            low: 0,
            high: -0.73,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'       
          },
          {
            name: 'BFFU1',
            low: 0,
            high: -0.54,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'       
          },
          {
            name: 'CAMC2',
            low: 0,
            high: 0,
            color: '#1a56b0',
            connectorColor: '#1a56b0',
            lowColor: '#1a56b0'       
          },
          {
            name: 'CCSU1',
            low: 0,
            high: -0.41,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'
          },
          {
            name: 'CLRU1',
            low: 0,
            high: -0.3,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'
          },
          {
            name: 'CRUU1',
            low: 0,
            high: 1.27,
            color: '#32a852',
            connectorColor: '#32a852',
            lowColor: '#32a852'
          },
          {
            name: 'DADU1',
            low: 0,
            high: 0.54,
            color: '#32a852',
            connectorColor: '#32a852',
            lowColor: '#32a852'
          },
          {
            name: 'DURU1',
            low: 0,
            high: -1.08,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'
          },
          {
            name: 'EGLC2',
            low: 0,
            high: 0,
            color: '#1a56b0',
            connectorColor: '#1a56b0',
            lowColor: '#1a56b0'
          },
          {
            name: 'GRVU1',
            low: 0,
            high: 0,
            color: '#1a56b0',
            connectorColor: '#1a56b0',
            lowColor: '#1a56b0'
          },
          {
            name: 'LCTU1',
            low: 0,
            high: -1.09,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'
          },
          {
            name: 'MBLC2',
            low: 0,
            high: -0.06,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'
          },
          {
            name: 'MNRC2',
            low: 0,
            high: 0.33,
            color: '#32a852',
            connectorColor: '#32a852',
            lowColor: '#32a852'
          },
          {
            name: 'STAU1',
            low: 0,
            high: -0.09,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'
          },
          {
            name: 'STIU1',
            low: 0,
            high: 0,
            color: '#1a56b0',
            connectorColor: '#1a56b0',
            lowColor: '#1a56b0'
          },
          {
            name: 'STMC2',
            low: 0,
            high: 0.11,
            color: '#32a852',
            connectorColor: '#32a852',
            lowColor: '#32a852'
          },
          {
            name: 'TADU1',
            low: 0,
            high: 0,
            color: '#1a56b0',
            connectorColor: '#1a56b0',
            lowColor: '#1a56b0'
          },
          {
            name: 'YDLC2',
            low: 0,
            high: -0.22,
            color: '#c42525',
            connectorColor: '#c42525',
            lowColor: '#c42525'
          }
        ]
        const flowData = 
        [
          { name: 'BCTU1', low: 0, high: -0.23 },
          { name: 'BFFU1', low: 0, high: -5.14 },
          { name: 'CAMC2', low: 0, high: 0 },
          { name: 'CCSU1', low: 0, high: -0.02 },
          { name: 'CLRU1', low: 0, high: -11.74 },
          { name: 'CRUU1', low: 0, high: 0.2 },
          { name: 'DADU1', low: 0, high: 0.84 },
          { name: 'DURU1', low: 0, high: -2.74 },
          { name: 'EGLC2', low: 0, high: 0 },
          { name: 'GRVU1', low: 0, high: 0 },
          { name: 'LCTU1', low: 0, high: -0.38 },
          { name: 'MBLC2', low: 0, high: -0.53 },
          { name: 'MNRC2', low: 0, high: 0.08 },
          { name: 'STAU1', low: 0, high: -0.07 },
          { name: 'STIU1', low: 0, high: 0 },
          { name: 'STMC2', low: 0, high: 0.26 },
          { name: 'TADU1', low: 0, high: 0 },
          { name: 'YDLC2', low: 0, high: -2.5 }
        ]
        const stnNormalInfo=
          {
            STMC2: {
              firstMedian: 249.61078050000003,
              secondMedian: 252.238584,
              diffPercent: 1.052760419536435
            },
            MBLC2: {
              firstMedian: 894.5544214999999,
              secondMedian: 889.2689459999999,
              diffPercent: -0.5908500783146553
            },
            YDLC2: {
              firstMedian: 1119.0254015,
              secondMedian: 1094.001022,
              diffPercent: -2.2362655455770835
            },
            STIU1: {
              firstMedian: 30.786833499999997,
              secondMedian: 30.786833499999997,
              diffPercent: 0
            },
            CRUU1: {
              firstMedian: 15.481008500000002,
              secondMedian: 17.446429000000002,
              diffPercent: 12.695687751867071
            },
            STAU1: {
              firstMedian: 84.0834815,
              secondMedian: 83.35798100000001,
              diffPercent: -0.8628335638076492
            },
            TADU1: {
              firstMedian: 82.48972599999999,
              secondMedian: 82.48972599999999,
              diffPercent: 0
            },
            DADU1: {
              firstMedian: 156.4825065,
              secondMedian: 164.86977499999998,
              diffPercent: 5.3598761213605535
            },
            DURU1: {
              firstMedian: 254.783388,
              secondMedian: 227.373586,
              diffPercent: -10.758080507195396
            },
            GRVU1: {
              firstMedian: 2499.7863895,
              secondMedian: 2499.7863895,
              diffPercent: 0
            },
            MNRC2: {
              firstMedian: 24.100364588615,
              secondMedian: 24.89014761323,
              diffPercent: 3.2770584100959663
            },
            BFFU1: {
              firstMedian: 950.79872,
              secondMedian: 899.3597869999999,
              diffPercent: -5.410075962239425
            },
            LCTU1: {
              firstMedian: 34.51851649999999,
              secondMedian: 30.744539,
              diffPercent: -10.933197259505608
            },
            BCTU1: {
              firstMedian: 31.250065499999998,
              secondMedian: 28.958334500000003,
              diffPercent: -7.333523828934039
            },
            CCSU1: {
              firstMedian: 6.0014845,
              secondMedian: 5.755623499999999,
              diffPercent: -4.096669748959635
            },
            EGLC2: {
              firstMedian: 1319.0557685,
              secondMedian: 1319.0557685,
              diffPercent: 0
            },
            CAMC2: {
              firstMedian: 2175.7382024999997,
              secondMedian: 2175.7382024999997,
              diffPercent: 0
            },
            CLRU1: {
              firstMedian: 3915.6903245000003,
              secondMedian: 3798.2772710000004,
              diffPercent: -2.9985275588664577
            }
          }
        function rounded(number){
          if(number){
            return Math.round(number * 10) / 10
          }
        }
         console.log('hi')
                                                                                                                      

         Highcharts.chart('container', {

            chart: {
              type: 'dumbbell',
              inverted: true
            },

            legend: {
              enabled: false
            },

            subtitle: {
              text: '1981-2010 vs 1991-2020'
            },

            title: {
              text: 'Normal Change (by Value)'
            },

            tooltip: {
              shared: true
            },

            xAxis: [{
              type: 'category',
              reversed: true,
             
              
          }, ],

            yAxis: {
              title: {
                text: 'Q Change in Normal'
              }
            },
            tooltip: {
                    formatter: function () {
                        const stnInfo = stnNormalInfo ? stnNormalInfo[this.key] : undefined
                        return `${stnNormalInfo[this.key]}: <br />Previous Normal:${rounded(stnInfo?.firstMedian)}  New Normal:${rounded(stnInfo?.secondMedian)} Percent Change: ${stnInfo?.diffPercent ? rounded(stnInfo?.diffPercent): 'N/A'}`
                    }
                },

            series: [{
              name: 'Normal Change by Value',
              data: flowData
            }]

            });

            Highcharts.chart('container1', {

            chart: {
              type: 'dumbbell',
              inverted: true
            },

            plotOptions: {
              dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b><br>{point.diffPercent:.1f} %',
                // distance: -50,
                filter: {
                    property: 'diffPercent',
                    operator: '>',
                    value: 0
                }
            }
          },

            legend: {
              enabled: false
            },

            subtitle: {
              text: '1981-2010 vs 1991-2020'
            },

            title: {
              text: 'Normal Change (By Percentage)'
            },

            tooltip: {
              shared: true
            },

            xAxis: {
              type: 'category'
            },

            yAxis: {
              title: {
                text: 'Q Change in Normal (%)'
              }
            },
            tooltip: {
                    formatter: function () {
                        console.log('this', this, this.x, this.y, stnNormalInfo[this.key])
                        const stnInfo = stnNormalInfo ? stnNormalInfo[this.key] : undefined
                        return `${this.key}: <br />Previous Normal:${rounded(stnInfo?.firstMedian)} <br /> New Normal:${rounded(stnInfo?.secondMedian)} <br />Percent Change: ${stnInfo?.diffPercent ? rounded(stnInfo?.diffPercent): 'N/A'}`
                    }
                },

            series: [{
              name: 'Normal Percent Change',
              data: flowDataPercent
            }]

            });


      </script>
      
   </body>
</html>